<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\DM;
use Illuminate\Support\Facades\DB;   

class TestController extends Controller
{
    public function index()
    {
        $start = '2022-01-01';
        $end = '2022-12-31';

        $records = DB::table('test')->get()->toArray();
        $modifiedRecords = [];
        
        // false else if (filter_start < start_date AND filter_end_date > end_date OR filter_start < start_date AND filter_end_date < end_date AND filter_end_date > start_date)

        // if (filter_start > start_date AND filter_end_date < end_date OR filter_start > start_date AND filter_end_date > end_date AND filter_start_date < end_date)
        //  else if (filter_start < start_date AND end_date < filter_end_date OR filter_start < start_date AND end_date > filter_end_date AND filter_end_date > start_date)

        foreach($records as $record) {
            if ($record->enddate == NULL):
                $record->enddate = date('Y-m-d');
            endif;
            if ($record->contract_enddate == NULL):
                $record->contract_enddate = date('Y-m-d');
            endif;

            if ( ($start >= $record->contract_startdate && $end <= $record->contract_enddate) || ($start >= $record->contract_startdate && $end >= $record->contract_enddate && $start <= $record->enddate) ) {
                echo "first:" . ($start >= $record->contract_startdate && $end <= $record->contract_enddate) || ($start >= $record->contract_startdate && $end >= $record->contract_enddate && $start <= $record->enddate) . "<br>";
                $modifiedRecords[] = $record;
            } else if ( ($start <= $record->contract_startdate && $end <= $record->contract_enddate) || ($start <= $record->contract_startdate && $end >= $record->contract_enddate && $start >= $record->enddate) ) {
                // $modifiedRecords[] = $record;
                // echo "second:" . ($start <= $record->contract_startdate && $end <= $record->contract_enddate) || ($start <= $record->contract_startdate && $end >= $record->contract_enddate && $start >= $record->enddate) . "<br>";
            }
        }
        
        dd($modifiedRecords);

    }

    public function faker()
    {
        for ($i =1; $i<=25; $i++) {
            $employee_id = mt_rand(1, 25);
            $contract_start = mt_rand(2021,2022) . '-' . mt_rand(01,12) . '-' . mt_rand(1,31);
            $contract_end = mt_rand(2023,2023) . '-' . mt_rand(01,12) . '-' . mt_rand(1,31);
            $absent_start = mt_rand(2021,2022) . '-' . mt_rand(01,12) . '-' . mt_rand(1,31);
            $absent_end = mt_rand(2022,2023) . '-' . mt_rand(01,12) . '-' . mt_rand(1,31);

            DM::table('test')->insert([
                'employeeid' => $employee_id,
                'contract_startdate' => $contract_start,
                'contract_enddate' => $contract_end,
                'startdate' => $absent_start,
                'enddate' => $absent_end,
            ]);
        }

        echo 'Record inserted successfully.';
    }
}
